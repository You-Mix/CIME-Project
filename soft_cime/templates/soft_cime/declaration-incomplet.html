{% extends "layout/base.html" %}

{% block title %}
Gestion | SoftCIME
{% endblock title %}

{% block titleSide %}
Gestion et suivi
{% endblock titleSide %}

{% block liSide %}
    <li class="nav-item">
        <a href="{% url 'liste_declaration' %}" class="nav-link align-middle px-0 text-white-50">
            <i class="bi bi-list-ol"></i> <span class="ms-1 d-none d-sm-inline">Déclarations</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="{%url 'new_declaration'%}" class="nav-link align-middle px-0 text-white-50">
            <i class="bi bi-plus-circle-fill"></i> <span class="ms-1 d-none d-sm-inline">Nouvelle Déclaration</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="{% url 'declaration_incomplete' %}" class="nav-link align-middle px-0 text-white fw-bold">
            <i class="bi bi-list-ol"></i> <span class="ms-1 d-none d-sm-inline">Déclarations incomplete</span>
        </a>
    </li>
    <li class="nav-item">
        <a href="#" class="nav-link align-middle px-0 text-white-50">
            <i class="bi bi-pen-fill"></i> <span class="ms-1 d-none d-sm-inline">Plan d'action</span>
        </a>
    </li>

{% endblock liSide %}

{% block contain %}
    <h4 class="bg-success text-white text-center">{{nbdeclaration}}  Déclarations</h4>
    <table id="example" class="table table-striped table-bordered table-hover" style="width:100%" >
        
        <thead>
            <tr>
                <th rowspan="2">N° AVIS</th>
                <th rowspan="2">Date émission</th>
                <th colspan="2" class="text-center">Contribuable</th>
                <th rowspan="2">Chiffre d'affaire</th>
                <th rowspan="2">Impôts</th>
                <th rowspan="2">Date Limite</th>
                <th rowspan="2">Emis par</th>
                <th rowspan="2">Modifier</th>
            </tr>
            <tr>
                <th>NIU</th>
                <th>Raison Sociale</th>
            </tr>
        </thead>
        <tbody>
           {% for declaration in declarations %}
            {% if declaration.impots.count == 0 %}
                <tr>
                    <td>{{declaration.num_avis}}</td>
                    <td>{{declaration.date_emission}}</td>
                    <td>{{declaration.contribuable.NIU}}</td>
                    <td>{{declaration.contribuable.raison_social}}</td>
                    <td>{{declaration.chiffre_affaire}}</td>
                    <td>
                        {% if declaration.impots.count == 0 %}
                        <i class="text-danger text-center">Manquant</i>
                        {% else %}
                            {% for impot in impots_declare %}
                                {% if impot.declaration == declaration %}
                                    {{impot.impot.impot}} : {{impot.montant}} <br />
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </td>
                    <td>{{declaration.date_limite}}</td>
                    <td>{{declaration.personnel.nom}}</td>
                    <td>
                        <a href="{% url 'update_declaration' declaration.id %}" class="text-primary text-center" class="text-danger" alt="Supprimer ?"><i class="bi bi-pencil-fill"></i></a>
                    </td>
                </tr>
                {% endif %}
            {% endfor %}
            
        </tbody>
        <tfoot>
            <tr>
                <th>N° AVIS</th>
                <th>Date émission</th>
                <th colspan="2" class="text-center">Contribuable</th>
                <th>Chiffre d'affaire</th>
                <th>Impôts</th>
                <th>Date Limite</th>
                <th>Emis par</th>
                <th>Modifier</th>
            </tr>
        </tfoot>
    </table>





    <script>
        document.getElementById('gestion').classList.add('fw-bold')
        document.getElementById('gestion').classList.add('fs-5')
    </script>
{% endblock contain %}